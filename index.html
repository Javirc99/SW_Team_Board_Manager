<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SATCOM/F-EMIDS Board Manager</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // Lucide React icons as inline SVG components
        const Lock = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4"></path>
            </svg>
        );
        
        const Unlock = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect>
                <path d="M7 11V7a5 5 0 0 1 9.9-1"></path>
            </svg>
        );
        
        const User = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                <circle cx="12" cy="7" r="4"></circle>
            </svg>
        );
        
        const Clock = ({ size = 24, className = "" }) => (
            <svg width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        // Mock storage API for standalone HTML
        window.storage = {
            async get(key, shared = false) {
                const storageKey = shared ? `shared_${key}` : `user_${key}`;
                const value = localStorage.getItem(storageKey);
                return value ? { key, value, shared } : null;
            },
            async set(key, value, shared = false) {
                const storageKey = shared ? `shared_${key}` : `user_${key}`;
                localStorage.setItem(storageKey, value);
                return { key, value, shared };
            },
            async delete(key, shared = false) {
                const storageKey = shared ? `shared_${key}` : `user_${key}`;
                localStorage.removeItem(storageKey);
                return { key, deleted: true, shared };
            },
            async list(prefix = '', shared = false) {
                const storagePrefix = shared ? 'shared_' : 'user_';
                const keys = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key.startsWith(storagePrefix + prefix)) {
                        keys.push(key.substring(storagePrefix.length));
                    }
                }
                return { keys, prefix, shared };
            }
        };

        const BoardManager = () => {
            const [boards, setBoards] = useState([]);
            const [userName, setUserName] = useState('');
            const [showNameDialog, setShowNameDialog] = useState(false);
            const [loading, setLoading] = useState(true);

            const boardDefinitions = [
                { id: 'zcu102-1', name: 'ZCU102 Board #1', type: 'ZCU102' },
                { id: 'zcu102-2', name: 'ZCU102 Board #2', type: 'ZCU102' },
                { id: 'te0818-1', name: 'TE0818 Board #1', type: 'TE0818' }
            ];

            useEffect(() => {
                loadData();
            }, []);

            const loadData = async () => {
                try {
                    const storedName = await window.storage.get('user-name');
                    if (storedName) {
                        setUserName(storedName.value);
                    }

                    const storedBoards = await window.storage.get('board-states', true);
                    if (storedBoards) {
                        setBoards(JSON.parse(storedBoards.value));
                    } else {
                        const initialBoards = boardDefinitions.map(def => ({
                            ...def,
                            locked: false,
                            lockedBy: null,
                            lockedAt: null
                        }));
                        setBoards(initialBoards);
                        await window.storage.set('board-states', JSON.stringify(initialBoards), true);
                    }
                } catch (error) {
                    const initialBoards = boardDefinitions.map(def => ({
                        ...def,
                        locked: false,
                        lockedBy: null,
                        lockedAt: null
                    }));
                    setBoards(initialBoards);
                } finally {
                    setLoading(false);
                }
            };

            const saveName = async (name) => {
                try {
                    await window.storage.set('user-name', name);
                    setUserName(name);
                    setShowNameDialog(false);
                } catch (error) {
                    console.error('Failed to save name:', error);
                }
            };

            const toggleLock = async (boardId) => {
                if (!userName) {
                    setShowNameDialog(true);
                    return;
                }

                const updatedBoards = boards.map(board => {
                    if (board.id === boardId) {
                        if (board.locked && board.lockedBy !== userName) {
                            alert(`This board is locked by ${board.lockedBy}`);
                            return board;
                        }
                        return {
                            ...board,
                            locked: !board.locked,
                            lockedBy: !board.locked ? userName : null,
                            lockedAt: !board.locked ? new Date().toISOString() : null
                        };
                    }
                    return board;
                });

                setBoards(updatedBoards);
                try {
                    await window.storage.set('board-states', JSON.stringify(updatedBoards), true);
                } catch (error) {
                    console.error('Failed to save board states:', error);
                }
            };

            const formatTime = (isoString) => {
                if (!isoString) return '';
                const date = new Date(isoString);
                const now = new Date();
                const diffMs = now - date;
                const diffMins = Math.floor(diffMs / 60000);
                const diffHours = Math.floor(diffMins / 60);
                
                if (diffMins < 1) return 'just now';
                if (diffMins < 60) return `${diffMins}m ago`;
                if (diffHours < 24) return `${diffHours}h ago`;
                return date.toLocaleDateString();
            };

            if (loading) {
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 flex items-center justify-center">
                        <div className="text-white text-xl">Loading...</div>
                    </div>
                );
            }

            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-blue-900 to-slate-900 p-8">
                    <div className="max-w-6xl mx-auto">
                        <div className="bg-white/10 backdrop-blur-lg rounded-2xl shadow-2xl p-8 mb-6">
                            <div className="flex items-center justify-center mb-6">
                                <div className="bg-white px-8 py-4 rounded-lg mr-4 shadow-lg">
                                    <svg className="h-12" viewBox="0 0 120 40" fill="none" xmlns="http://www.w3.org/2000/svg">
                                        <path d="M5 8 L5 32" stroke="#003D7A" strokeWidth="3" strokeLinecap="round"/>
                                        <path d="M15 8 L15 32 M15 8 L30 32 M30 8 L30 32" stroke="#003D7A" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round"/>
                                        <path d="M40 8 L40 32 M40 8 Q50 8 50 18 Q50 28 40 28 L45 32" stroke="#003D7A" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" fill="none"/>
                                        <path d="M60 8 L60 32 M60 8 Q70 8 70 18 Q70 28 60 28 L65 32" stroke="#003D7A" strokeWidth="2.5" strokeLinecap="round" strokeLinejoin="round" fill="none"/>
                                        <path d="M78 8 L90 8 M84 8 L84 32 M78 32 L90 32" stroke="#003D7A" strokeWidth="2.5" strokeLinecap="round"/>
                                        <path d="M98 8 L110 32 M110 8 L98 32" stroke="#003D7A" strokeWidth="2.5" strokeLinecap="round"/>
                                    </svg>
                                </div>
                                <h2 className="text-2xl font-bold text-white">Indra Group</h2>
                            </div>
                            <div className="flex justify-between items-center mb-2">
                                <h1 className="text-4xl font-bold text-white">SATCOM/F-EMIDS Board Manager</h1>
                                <div className="flex items-center gap-2 bg-white/20 px-4 py-2 rounded-lg">
                                    <User size={20} className="text-white" />
                                    <span className="text-white font-medium">{userName || 'Not set'}</span>
                                    <button
                                        onClick={() => setShowNameDialog(true)}
                                        className="ml-2 text-xs bg-white/30 hover:bg-white/40 px-2 py-1 rounded text-white"
                                    >
                                        Change
                                    </button>
                                </div>
                            </div>
                            <p className="text-blue-200 text-lg">Lock and manage shared development boards</p>
                        </div>

                        <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            {boards.map(board => (
                                <div
                                    key={board.id}
                                    className={`rounded-xl shadow-xl overflow-hidden transition-all duration-300 ${
                                        board.locked
                                            ? 'bg-gradient-to-br from-red-500/20 to-red-600/20 border-2 border-red-500/50'
                                            : 'bg-gradient-to-br from-green-500/20 to-green-600/20 border-2 border-green-500/50'
                                    }`}
                                >
                                    <div className="p-6">
                                        <div className="flex items-start justify-between mb-4">
                                            <div>
                                                <h3 className="text-xl font-bold text-white mb-1">{board.name}</h3>
                                                <span className="text-sm bg-white/20 px-2 py-1 rounded text-white">
                                                    {board.type}
                                                </span>
                                            </div>
                                            {board.locked ? (
                                                <Lock size={32} className="text-red-400" />
                                            ) : (
                                                <Unlock size={32} className="text-green-400" />
                                            )}
                                        </div>

                                        <div className="mb-4 min-h-[60px]">
                                            {board.locked ? (
                                                <div className="space-y-2">
                                                    <div className="flex items-center gap-2 text-white">
                                                        <User size={16} />
                                                        <span className="text-sm font-medium">{board.lockedBy}</span>
                                                    </div>
                                                    <div className="flex items-center gap-2 text-blue-200">
                                                        <Clock size={16} />
                                                        <span className="text-sm">{formatTime(board.lockedAt)}</span>
                                                    </div>
                                                </div>
                                            ) : (
                                                <div className="text-green-300 text-sm font-medium">
                                                    Available for use
                                                </div>
                                            )}
                                        </div>

                                        <button
                                            onClick={() => toggleLock(board.id)}
                                            disabled={board.locked && board.lockedBy !== userName}
                                            className={`w-full py-3 px-4 rounded-lg font-semibold transition-all duration-200 flex items-center justify-center gap-2 ${
                                                board.locked && board.lockedBy !== userName
                                                    ? 'bg-gray-600 cursor-not-allowed text-gray-300'
                                                    : board.locked
                                                    ? 'bg-red-600 hover:bg-red-700 text-white'
                                                    : 'bg-green-600 hover:bg-green-700 text-white'
                                            }`}
                                        >
                                            {board.locked && board.lockedBy !== userName ? (
                                                <>
                                                    <Lock size={20} />
                                                    Locked by {board.lockedBy}
                                                </>
                                            ) : board.locked ? (
                                                <>
                                                    <Unlock size={20} />
                                                    Release Lock
                                                </>
                                            ) : (
                                                <>
                                                    <Lock size={20} />
                                                    Lock Board
                                                </>
                                            )}
                                        </button>
                                    </div>
                                </div>
                            ))}
                        </div>

                        <div className="mt-8 bg-white/10 backdrop-blur-lg rounded-xl p-6">
                            <h2 className="text-xl font-bold text-white mb-3">How to Use</h2>
                            <ul className="text-blue-200 space-y-2">
                                <li>• Set your name using the button in the top right</li>
                                <li>• Click "Lock Board" to reserve a board for your use</li>
                                <li>• Click "Release Lock" when you're done to make it available to others</li>
                                <li>• Board states are shared with all team members in real-time</li>
                            </ul>
                        </div>
                    </div>

                    {showNameDialog && (
                        <div className="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center p-4 z-50">
                            <div className="bg-white rounded-xl shadow-2xl p-8 max-w-md w-full">
                                <h2 className="text-2xl font-bold text-gray-800 mb-4">Set Your Name</h2>
                                <input
                                    type="text"
                                    placeholder="Enter your name"
                                    defaultValue={userName}
                                    className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-4 text-lg focus:outline-none focus:border-blue-500"
                                    onKeyPress={(e) => {
                                        if (e.key === 'Enter' && e.target.value.trim()) {
                                            saveName(e.target.value.trim());
                                        }
                                    }}
                                    autoFocus
                                />
                                <div className="flex gap-3">
                                    <button
                                        onClick={() => setShowNameDialog(false)}
                                        className="flex-1 py-3 px-4 bg-gray-200 hover:bg-gray-300 rounded-lg font-semibold text-gray-700"
                                    >
                                        Cancel
                                    </button>
                                    <button
                                        onClick={(e) => {
                                            const input = e.target.parentElement.parentElement.querySelector('input');
                                            if (input.value.trim()) {
                                                saveName(input.value.trim());
                                            }
                                        }}
                                        className="flex-1 py-3 px-4 bg-blue-600 hover:bg-blue-700 rounded-lg font-semibold text-white"
                                    >
                                        Save
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        ReactDOM.render(<BoardManager />, document.getElementById('root'));
    </script>
</body>
</html>
