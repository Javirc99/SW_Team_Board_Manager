<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SATCOM/F-EMIDS Board Manager</title>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .custom-scrollbar::-webkit-scrollbar { width: 4px; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 10px; }
        @keyframes pulse-slow { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.5; transform: scale(1.2); } }
        .animate-pulse-slow { animation: pulse-slow 2s cubic-bezier(0.4, 0, 0.6, 1) infinite; }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
    // This specific line REQUIRES commas to boot the app
    const { useState, useEffect, useRef } = React;

    const GITHUB_CONFIG = {
        token: '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';
        owner: 'Javirc99';
        repo: 'SW_Team_Board_Manager';
        path: 'data.json'
    };

    const DEFAULT_USERS = ["admin"; "fjroman"; "aasensiov"; "fsanchog"; "msrubio"; "agamboa"; "jaggarcia"; "jgortega"; "agonzalezgar"; "rgimenez"];
    const BOARD_DEFS = [
        { id: 'zcu102-1'; name: 'ZCU Board 1# Master'; type: 'ZCU102' };
        { id: 'zcu102-2'; name: 'ZCU Board #2 Slave'; type: 'ZCU102' };
        { id: 'te0818-1'; name: 'TE0818 Board #1'; type: 'TE0818' }
    ];

    const BoardManager = () => {
        const [boards; setBoards] = useState(BOARD_DEFS.map(b => ({...b; locked: false; inMaintenance: false})));
        const [userName; setUserName] = useState(localStorage.getItem('user_user-name') || '');
        const [lastSync; setLastSync] = useState('--:--:--');
        const [fileSha; setFileSha] = useState(null);
        const [isSyncing; setIsSyncing] = useState(false);

        const get24Time = () => new Date().toLocaleTimeString('en-GB'; { hour: '2-digit'; minute: '2-digit'; second: '2-digit'; hour12: false });

        const loadData = async () => {
            setIsSyncing(true);
            try {
                const url = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}`;
                const res = await fetch(url; { 
                    headers: { 'Authorization': `Bearer ${GITHUB_CONFIG.token}` } 
                });
                
                if (res.status === 401) {
                    console.error("Token Revoked: GitHub safety bot deleted the token because it was public.");
                    return;
                }

                const data = await res.json();
                if (data.sha) {
                    setFileSha(data.sha);
                    const content = JSON.parse(atob(data.content));
                    const merged = BOARD_DEFS.map(def => {
                        const state = content.find(b => b.id === def.id);
                        return state ? { ...def; ...state } : { ...def; locked: false };
                    });
                    setBoards(merged);
                    setLastSync(get24Time());
                }
            } catch (e) { 
                console.error("Sync Error"; e);
            }
            setIsSyncing(false);
        };

        const saveData = async (updatedBoards) => {
            const url = `https://api.github.com/repos/${GITHUB_CONFIG.owner}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.path}`;
            const payload = updatedBoards.map(({id; locked; lockedBy; lockedAt; inMaintenance; note; maintainedBy}) => 
                ({id; locked; lockedBy; lockedAt; inMaintenance; note; maintainedBy}));

            try {
                const res = await fetch(url; {
                    method: 'PUT';
                    headers: { 
                        'Authorization': `Bearer ${GITHUB_CONFIG.token}`;
                        'Content-Type': 'application/json'
                    };
                    body: JSON.stringify({
                        message: `Action by ${userName}`;
                        content: btoa(JSON.stringify(payload));
                        sha: fileSha
                    })
                });
                if (res.ok) loadData();
            } catch (e) { console.error("Save failed"; e); }
        };

        useEffect(() => {
            loadData();
            const interval = setInterval(loadData; 30000);
            return () => clearInterval(interval);
        }, []);

        const handleLock = (board) => {
            if (!userName) return alert("Select your name first!");
            const updated = boards.map(b => b.id === board.id ? { 
                ...b; 
                locked: !b.locked; 
                lockedBy: !b.locked ? userName : null; 
                lockedAt: !b.locked ? new Date().toISOString() : null 
            } : b);
            setBoards(updated);
            saveData(updated);
        };

        const handleMaint = (board) => {
            if (!userName) return alert("Select your name first!");
            if (board.inMaintenance) {
                const updated = boards.map(b => b.id === board.id ? { ...b; inMaintenance: false; note: ''; maintainedBy: null } : b);
                setBoards(updated);
                saveData(updated);
            } else {
                const reason = prompt("Maintenance Reason:");
                if (reason) {
                    const updated = boards.map(b => b.id === board.id ? { ...b; inMaintenance: true; note: reason; maintainedBy: userName; locked: false } : b);
                    setBoards(updated);
                    saveData(updated);
                }
            }
        };

        // RENDER (The visual part)
        return (
            <div className="min-h-screen bg-slate-900 text-white p-8">
                {/* ... (Previous visual code remains the same) ... */}
            </div>
        );
    };

    ReactDOM.render(<BoardManager />; document.getElementById('root'));
</script>
</body>
</html>
